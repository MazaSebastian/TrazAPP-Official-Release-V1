// Predefined palette of soft, distinct colors suitable for backgrounds with dark text
export const GENETIC_PALETTE = [
    'hsl(0, 70%, 85%)',
    'hsl(3, 80%, 93%)',
    'hsl(7, 90%, 85%)',
    'hsl(10, 70%, 93%)',
    'hsl(14, 80%, 85%)',
    'hsl(18, 90%, 93%)',
    'hsl(21, 70%, 85%)',
    'hsl(25, 80%, 93%)',
    'hsl(28, 90%, 85%)',
    'hsl(32, 70%, 93%)',
    'hsl(36, 80%, 85%)',
    'hsl(39, 90%, 93%)',
    'hsl(43, 70%, 85%)',
    'hsl(46, 80%, 93%)',
    'hsl(50, 90%, 85%)',
    'hsl(54, 70%, 93%)',
    'hsl(57, 80%, 85%)',
    'hsl(61, 90%, 93%)',
    'hsl(64, 70%, 85%)',
    'hsl(68, 80%, 93%)',
    'hsl(72, 90%, 85%)',
    'hsl(75, 70%, 93%)',
    'hsl(79, 80%, 85%)',
    'hsl(82, 90%, 93%)',
    'hsl(86, 70%, 85%)',
    'hsl(90, 80%, 93%)',
    'hsl(93, 90%, 85%)',
    'hsl(97, 70%, 93%)',
    'hsl(100, 80%, 85%)',
    'hsl(104, 90%, 93%)',
    'hsl(108, 70%, 85%)',
    'hsl(111, 80%, 93%)',
    'hsl(115, 90%, 85%)',
    'hsl(118, 70%, 93%)',
    'hsl(122, 80%, 85%)',
    'hsl(126, 90%, 93%)',
    'hsl(129, 70%, 85%)',
    'hsl(133, 80%, 93%)',
    'hsl(136, 90%, 85%)',
    'hsl(140, 70%, 93%)',
    'hsl(144, 80%, 85%)',
    'hsl(147, 90%, 93%)',
    'hsl(151, 70%, 85%)',
    'hsl(154, 80%, 93%)',
    'hsl(158, 90%, 85%)',
    'hsl(162, 70%, 93%)',
    'hsl(165, 80%, 85%)',
    'hsl(169, 90%, 93%)',
    'hsl(172, 70%, 85%)',
    'hsl(176, 80%, 93%)',
    'hsl(180, 90%, 85%)',
    'hsl(183, 70%, 93%)',
    'hsl(187, 80%, 85%)',
    'hsl(190, 90%, 93%)',
    'hsl(194, 70%, 85%)',
    'hsl(198, 80%, 93%)',
    'hsl(201, 90%, 85%)',
    'hsl(205, 70%, 93%)',
    'hsl(208, 80%, 85%)',
    'hsl(212, 90%, 93%)',
    'hsl(216, 70%, 85%)',
    'hsl(219, 80%, 93%)',
    'hsl(223, 90%, 85%)',
    'hsl(226, 70%, 93%)',
    'hsl(230, 80%, 85%)',
    'hsl(234, 90%, 93%)',
    'hsl(237, 70%, 85%)',
    'hsl(241, 80%, 93%)',
    'hsl(244, 90%, 85%)',
    'hsl(248, 70%, 93%)',
    'hsl(252, 80%, 85%)',
    'hsl(255, 90%, 93%)',
    'hsl(259, 70%, 85%)',
    'hsl(262, 80%, 93%)',
    'hsl(266, 90%, 85%)',
    'hsl(270, 70%, 93%)',
    'hsl(273, 80%, 85%)',
    'hsl(277, 90%, 93%)',
    'hsl(280, 70%, 85%)',
    'hsl(284, 80%, 93%)',
    'hsl(288, 90%, 85%)',
    'hsl(291, 70%, 93%)',
    'hsl(295, 80%, 85%)',
    'hsl(298, 90%, 93%)',
    'hsl(302, 70%, 85%)',
    'hsl(306, 80%, 93%)',
    'hsl(309, 90%, 85%)',
    'hsl(313, 70%, 93%)',
    'hsl(316, 80%, 85%)',
    'hsl(320, 90%, 93%)',
    'hsl(324, 70%, 85%)',
    'hsl(327, 80%, 93%)',
    'hsl(331, 90%, 85%)',
    'hsl(334, 70%, 93%)',
    'hsl(338, 80%, 85%)',
    'hsl(342, 90%, 93%)',
    'hsl(345, 70%, 85%)',
    'hsl(349, 80%, 93%)',
    'hsl(352, 90%, 85%)',
    'hsl(356, 70%, 93%)',
];

const BORDER_PALETTE = [
    'hsl(0, 70%, 55%)',
    'hsl(3, 80%, 63%)',
    'hsl(7, 90%, 55%)',
    'hsl(10, 70%, 63%)',
    'hsl(14, 80%, 55%)',
    'hsl(18, 90%, 63%)',
    'hsl(21, 70%, 55%)',
    'hsl(25, 80%, 63%)',
    'hsl(28, 90%, 55%)',
    'hsl(32, 70%, 63%)',
    'hsl(36, 80%, 55%)',
    'hsl(39, 90%, 63%)',
    'hsl(43, 70%, 55%)',
    'hsl(46, 80%, 63%)',
    'hsl(50, 90%, 55%)',
    'hsl(54, 70%, 63%)',
    'hsl(57, 80%, 55%)',
    'hsl(61, 90%, 63%)',
    'hsl(64, 70%, 55%)',
    'hsl(68, 80%, 63%)',
    'hsl(72, 90%, 55%)',
    'hsl(75, 70%, 63%)',
    'hsl(79, 80%, 55%)',
    'hsl(82, 90%, 63%)',
    'hsl(86, 70%, 55%)',
    'hsl(90, 80%, 63%)',
    'hsl(93, 90%, 55%)',
    'hsl(97, 70%, 63%)',
    'hsl(100, 80%, 55%)',
    'hsl(104, 90%, 63%)',
    'hsl(108, 70%, 55%)',
    'hsl(111, 80%, 63%)',
    'hsl(115, 90%, 55%)',
    'hsl(118, 70%, 63%)',
    'hsl(122, 80%, 55%)',
    'hsl(126, 90%, 63%)',
    'hsl(129, 70%, 55%)',
    'hsl(133, 80%, 63%)',
    'hsl(136, 90%, 55%)',
    'hsl(140, 70%, 63%)',
    'hsl(144, 80%, 55%)',
    'hsl(147, 90%, 63%)',
    'hsl(151, 70%, 55%)',
    'hsl(154, 80%, 63%)',
    'hsl(158, 90%, 55%)',
    'hsl(162, 70%, 63%)',
    'hsl(165, 80%, 55%)',
    'hsl(169, 90%, 63%)',
    'hsl(172, 70%, 55%)',
    'hsl(176, 80%, 63%)',
    'hsl(180, 90%, 55%)',
    'hsl(183, 70%, 63%)',
    'hsl(187, 80%, 55%)',
    'hsl(190, 90%, 63%)',
    'hsl(194, 70%, 55%)',
    'hsl(198, 80%, 63%)',
    'hsl(201, 90%, 55%)',
    'hsl(205, 70%, 63%)',
    'hsl(208, 80%, 55%)',
    'hsl(212, 90%, 63%)',
    'hsl(216, 70%, 55%)',
    'hsl(219, 80%, 63%)',
    'hsl(223, 90%, 55%)',
    'hsl(226, 70%, 63%)',
    'hsl(230, 80%, 55%)',
    'hsl(234, 90%, 63%)',
    'hsl(237, 70%, 55%)',
    'hsl(241, 80%, 63%)',
    'hsl(244, 90%, 55%)',
    'hsl(248, 70%, 63%)',
    'hsl(252, 80%, 55%)',
    'hsl(255, 90%, 63%)',
    'hsl(259, 70%, 55%)',
    'hsl(262, 80%, 63%)',
    'hsl(266, 90%, 55%)',
    'hsl(270, 70%, 63%)',
    'hsl(273, 80%, 55%)',
    'hsl(277, 90%, 63%)',
    'hsl(280, 70%, 55%)',
    'hsl(284, 80%, 63%)',
    'hsl(288, 90%, 55%)',
    'hsl(291, 70%, 63%)',
    'hsl(295, 80%, 55%)',
    'hsl(298, 90%, 63%)',
    'hsl(302, 70%, 55%)',
    'hsl(306, 80%, 63%)',
    'hsl(309, 90%, 55%)',
    'hsl(313, 70%, 63%)',
    'hsl(316, 80%, 55%)',
    'hsl(320, 90%, 63%)',
    'hsl(324, 70%, 55%)',
    'hsl(327, 80%, 63%)',
    'hsl(331, 90%, 55%)',
    'hsl(334, 70%, 63%)',
    'hsl(338, 80%, 55%)',
    'hsl(342, 90%, 63%)',
    'hsl(345, 70%, 55%)',
    'hsl(349, 80%, 63%)',
    'hsl(352, 90%, 55%)',
    'hsl(356, 70%, 63%)',
];



export const getGeneticColor = (name?: string, dbColor?: string) => {
    if (dbColor) return { bg: dbColor, border: dbColor };
    if (!name) return { bg: '#F0FFF4', border: '#48BB78' }; // Default Green

    let hash = 5381;
    for (let i = 0; i < name.length; i++) {
        // DJB2 hash variant
        hash = ((hash << 5) + hash) + name.charCodeAt(i); /* hash * 33 + c */
    }

    const index = Math.abs(hash) % GENETIC_PALETTE.length;
    return {
        bg: GENETIC_PALETTE[index],
        border: BORDER_PALETTE[index] || BORDER_PALETTE[index % BORDER_PALETTE.length]
    };
};

export const generateUniqueColor = (existingColors: string[]): string => {
    const used = new Set(existingColors.map(c => c?.toUpperCase()));

    // 1. Try to find an unused color from our predefined beautiful palette
    const shuffledPalette = [...GENETIC_PALETTE].sort(() => 0.5 - Math.random());
    for (const color of shuffledPalette) {
        if (!used.has(color.toUpperCase())) {
            return color;
        }
    }

    // 2. If all predefined colors are used, safely fallback to a random pleasant hex color
    let randomColor;
    do {
        // Generate a lighter color suitable for backgrounds
        const r = Math.floor(Math.random() * 127 + 128).toString(16).padStart(2, '0');
        const g = Math.floor(Math.random() * 127 + 128).toString(16).padStart(2, '0');
        const b = Math.floor(Math.random() * 127 + 128).toString(16).padStart(2, '0');
        randomColor = `#${r}${g}${b}`.toUpperCase();
    } while (used.has(randomColor));

    return randomColor;
};
